<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.recorded.infra.codegroup.CodeGroupDao">

    <resultMap id="resultMapObj" type="com.recorded.infra.codegroup.CodeGroupDto"></resultMap>

    <!-- 공통구문 -->
    <sql id="selectCommon">
        from
        codegroup a
        WHERE 1=1

     <if test="shDelNy != null and shDelNy.equals('')">AND a.codeGroupdelNy = #{shDelNy}</if>

        <choose>
            <when test="shOption == 1">AND a.codeGroupSeq = #{shValue}</when>
            <when test="shOption == 2">AND a.codeGroupName LIKE CONCAT('%',#{shValue},'%')</when>
        </choose>
    </sql>

    <!-- 페이징을 고려한 리스트 조회 -->
    <select id="selectList" resultMap="resultMapObj">
        select
            codeGroupSeq
            ,codeGroupName
            ,(select count(*)
        from code aa
        where 1=1
        	and aa.codeGroupSeq = a.seq) as cdSeqCount
            ,codeGroupDelNy
            ,codeGroupRegDate
            ,codeGroupModDate
        <include refid="selectCommon"/>
        order by codeGroupSeq
        limit #{startRnumForMysql}, #{rowNumToShow}
    </select>

    <!-- total count -->
    <select id="getTotalCodeGroupCount" resultType="java.lang.Integer">
        SELECT COUNT(*)
    <include refid="selectCommon"/>
    </select>

    <!-- 코드 그룹 조회 -->
    <select id="selectOne" resultMap="resultMapObj">
        select
            codeGroupDelNy
            ,codeGroupSeq
            ,codeGroupName
            ,codeGroupModDate
        from codegroup
        where 1=1
            and codeGroupSeq=#{codeGroupSeq}
    </select>

    <!-- 코드 그룹 추가 -->
    <insert id="insert">
        insert into codegroup (codeGroupDelNy, codeGroupName, codeGroupRegDate, codeGroupModDate)
        values (#{codeGroupDelNy}, #{codeGroupName}, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
    </insert>

    <!-- 코드 그룹 수정 -->
    <update id="update">
        update codegroup
        set
            codeGroupMemo=#{codeGroupMemo}
            ,codeGroupName = #{codeGroupName}
        WHERE 1=1
            and codeGroupSeq = #{codeGroupSeq}
    </update>

    <!-- 코드 그룹 삭제 -->
    <update id="updtDel">
        update codegroup
        set
            codeGroupDelNy=1
        where 1=1
            and codeGroupSeq = #{codeGroupSeq}
    </update>

    <!-- 코드 그룹 삭제 -->
    <delete id="delete">
        delete from codegroup
        where codeGroupSeq=#{codeGroupSeq}
    </delete>

    <!-- 코드에서 코드 그룹 불러오기 -->
    <select id="selectListWithoutPaging" resultMap="resultMapObj">
        SELECT
            codeGroupSeq
            ,codeGroupName
        FROM codegroup
        WHERE 1=1
            AND codeGroupDelNy = 0
        ORDER BY codeGroupSeq DESC
    </select>

</mapper>
